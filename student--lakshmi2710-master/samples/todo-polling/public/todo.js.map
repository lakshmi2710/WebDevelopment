{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/services.js","webpack:///./src/todo.js"],"names":["fetchLogIn","username","fetch","method","headers","Headers","body","JSON","stringify","Promise","reject","code","then","response","ok","json","result","fetchLoginStatus","fetchTodos","appState","pollId","isLoggedIn","todos","error","renderLogin","show","login","document","querySelector","innerHTML","renderErrors","text","poll","shouldPoll","setInterval","renderPage","list","clearTimeout","renderTasks","tasks","map","item","join","addEventListener","e","target","classList","contains","value"],"mappings":"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","file":"todo.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/todo.js\");\n","export const fetchLogIn = (username) => {\n  return fetch('/session/', {\n    method: 'POST',\n    headers: new Headers({\n      'content-type': 'application/json',\n    }),\n    body: JSON.stringify({ username }),\n  })\n  .catch( () => {\n    return Promise.reject({code: 'network-error'});\n  })\n  .then( (response) => {\n    if(!response.ok) {\n      return response.json().then( result => Promise.reject(result) );\n    }\n    return response.json();\n  });\n};\n\nexport const fetchLoginStatus = () => {\n  return fetch('/session/', {\n    method: 'GET',\n  })\n  .catch( () => {\n    return Promise.reject({code: 'network-error'});\n  })\n  .then( (response) => {\n    if(!response.ok) {\n      return Promise.reject({ code: 'login-invalid' });\n    }\n    return;\n  });\n};\n\nexport const fetchTodos = () => {\n  return fetch('/todos', {\n    method: 'GET',\n  })\n  .catch( () => {\n    return Promise.reject({code: 'network-error'});\n  })\n  .then( (response) => {\n    if(!response.ok) {\n      return response.json().then( result => Promise.reject(result) );\n    }\n    return response.json();\n  });\n\n};\n","import {\n  fetchLogIn,\n  fetchLoginStatus,\n  fetchTodos\n} from './services';\n\nconst appState = {\n  pollId: null,\n  isLoggedIn: false,\n  todos: [],\n  error: '',\n};\n\nfunction renderLogin( show ) {\n  const login = document.querySelector('.login');\n  if(show) {\n    login.innerHTML = `\n      <label>Username: <input/></label>\n      <button class=\"to-login\" type=\"button\">Login</button>\n    `;\n  } else {\n    login.innerHTML = ``;\n  }\n}\n\nfunction renderErrors( text ) {\n  document.querySelector('.status').innerHTML = text;\n}\n\nfunction poll(shouldPoll) {\n  if( shouldPoll && !appState.pollId ) {\n    appState.pollId = setInterval( () => {\n      fetchTodos()\n      .catch( () => {\n        appState.error = 'this should be a real error message';\n        renderPage();\n      })\n      .then( list => {\n        appState.error = '';\n        appState.todos = list;\n        renderPage();\n      });\n    }, 3000);\n  }\n  // For when a user logs out:\n  if( !shouldPoll && appState.pollId ) {\n    clearTimeout(appState.pollId);\n    appState.pollId = null;\n  }\n}\n\nfunction renderTasks( list ) {\n  const tasks = document.querySelector('.todos');\n  tasks.innerHTML = list.map( (item) => `<li>${item}</li>` ).join('');\n}\n\nfunction renderPage() {\n  if(!appState.isLoggedIn)  {\n    renderLogin(true);\n    renderTasks([]);\n  } else {\n    renderLogin(false);\n    renderTasks(appState.todos);\n  }\n  renderErrors(appState.error);\n}\n\nconst login = document.querySelector('.login');\nlogin.addEventListener('click', (e) => {\n  if(!e.target.classList.contains('to-login')) {\n    return;\n  }\n\n  const username = login.querySelector('input').value;\n  fetchLogIn(username)\n  .then( (list) => {\n    appState.isLoggedIn = true;\n    appState.todos = list;\n    appState.error = '';\n    poll(true);\n    renderPage();\n  })\n  .catch( () => {\n    appState.error = 'Login failed';\n    renderPage();\n  });\n});\n\n\n// Initial load\nfetchLoginStatus()\n.then( () => {\n  appState.isLoggedIn = true;\n  poll(true);\n  renderPage();\n})\n.catch( () => {\n  appState.isLoggedIn = false;\n  renderPage();\n});\n"],"sourceRoot":""}